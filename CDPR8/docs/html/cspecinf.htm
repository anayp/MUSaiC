<!DOCTYPE html>
<html lang="en">
<!-- cspecinf.htm - HTML5 version -->
<html>

<head>
<title>CDP SPECINFO Functions</title>
<meta charset="UTF-8" />
	<link rel = "stylesheet"
	 type = "text/css"
	 href = "cdpmanshtml5.css" />
<link rel="icon"  href="images/cdp_favicon.ico">  
    <style>
	a { text-decoration: none }
	a:hover { color:#FF3333;
          text-decoration: underline }          	
    </style>
</head>

<body>

<div id = "left"> <!-- Keep indexing on left ABOVE headlines so index goes to top of page -->

  <p>
  <div align = "center">
  <IMG SRC = "images/cdpcircs90.jpg"></a>
  </div>
  </p>

  <p>
  <nav>
  <!-- list-style-type NOT removing bullets in IE9, using Definition List -->
  <dl>
  <dt><a href="ccdpndex.htm" Target="_top"><b>Main Index</b></a>
  <dt><a href="cspecndx.htm" Target="_top"><b>Spectral Index</b></a> 
  <dt><a href="filestxt.htm" Target="_blank"><b>File Formats</b></a>
  <hr>
  <br>
  <dt><a href="#SPECINFOLIST"><b>SPECINFO:</b></a>
  <dt>&nbsp;&nbsp;<a href = "#CHANNEL"><b>CHANNEL</b></a>
  <dt>&nbsp;&nbsp;<a href = "#FREQUENCY"><b>FREQUENCY</b></a>
  <dt>&nbsp;&nbsp;<a href = "#LEVEL"><b>LEVEL</b></a>
  <dt>&nbsp;&nbsp;<a href = "#OCTVU"><b>OCTVU</b></a>
  <dt>&nbsp;&nbsp;<a href = "#PEAK"><b>PEAK</b></a>
  <dt>&nbsp;&nbsp;<a href = "#PRINT"><b>PRINT</b></a>
  <dt>&nbsp;&nbsp;<a href = "#REPORT"><b>REPORT</b></a>
  <dt>&nbsp;&nbsp;<a href = "#WINDOWCNT"><b>WINDOWCNT</b></a>
  <br><br />
  <b>OTHERS:</b><br>
  <dt>&nbsp;&nbsp;<a href = "#GETPARTIALS"><b>GET_PARTIALS</b></a>
  <dt>&nbsp;&nbsp;<a href = "#PEAKEXTRACT"><b>PEAK EXTRACT</b></a>
  <br><br /> 
  <dt><a href = "#SPECINFOTECHNICAL"><b>Technical</b></a>

  </dl>
  </p>

</div>  <!-- End of left index panel -->

<div id = "right"> <!-- Keep headlines here so index goes to top of page -->

   <div id = "head">
   <!-- 
   <p><IMG SRC="images/cdpcircs.jpg" align=left ALT="CDP circles logo"></a></p>
   -->
   <div align=center>
   <br>
   <img src="images/cdplogo2.jpg" ALT="CDP Logo">
   </div>

   <h1 align=center>
   CDP Spectral Information</h1>
   <h2 align=center><font color="#3366ff"> (with Command Line Usage)</font></h2>
   </div>  <!-- End of 'head' -->


<!-- ========================================================================= -->
<h2 align = "center" id="SPECINFOLIST">Functions to obtain information on spectral data</h2>

<p>
<b>Names in brackets mean that these are separate programs.  The others are sub-modules of SPECINFO.</b>
</p>

<dl>
<dt><a href="#CHANNEL"><b>CHANNEL</b></a> <dd>Returns PVOC channel number corresponding to frequency given</dd>
<dt><a href="#FREQUENCY"><b>FREQUENCY</b></a> <dd>Returns centre frequency of the PVOC channel specified</dd>
<dt><a href="#GETPARTIALS"><b>[GET_PARTIALS]</b></a> <dd>Extract relative amplitudes of partials in a pitched source</dd>
<dt><a href="#LEVEL"><b>LEVEL</b></a> <dd>Convert (varying) level of analysis file to a pseudo-soundfile, for viewing (1 window -&gt; 1 sample)</dd>
<dt><a href="#OCTVU"><b>OCTVU</b></a> <dd>Text display of the time varying amplitude of the spectrum, within octave bands</dd>
<dt><a href="#PEAK"><b>PEAK</b></a> <dd>Locate time varying energy centre of spectrum (text display)</dd>
<dt><a href="#PEAKEXTRACT"><b>[PEAK EXTRACT]</b></a> <dd>Extract spectral peaks from analysis file and write to a text file</dd>
<dt><a href="#PRINT"><b>PRINT</b></a> <dd>Print data in an analysis file as text to file</dd>
<dt><a href="#REPORT"><b>REPORT</b></a> <dd>Text report on location of frequency peaks in the evolving spectrum</dd>
<dt><a href="#WINDOWCNT"><b>WINDOWCNT</b></a> <dd>Returns the number of windows in the <i>infile</i></dd><br>

<dt><a href="#SPECINFOTECHNICAL"><b>Technical Discussion</b></a> <dd>FFT 
Analysis DATA</dd>
</dl>

<p>
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> 
to Main Index for the CDP System.<br>
<a href="cspecndx.htm" Target="_top"><b>Return</b></a> 
to Spectral Index
</p>


<hr><!-- ********************************************************* -->
 
<h2 id="CHANNEL">SPECINFO CHANNEL &#150; Returns PVOC channel number 
corresponding to a given frequency</h2>

<h3>
Usage
</h3>
<b>specinfo channel</b> <i>infile frequency</i>
<br>

<h3>
Parameters
</h3>

<blockquote>
<i>infile</i> &#150; input analysis file made with PVOC<br>
<i>frequency</i> &#150; frequency in Hz
</blockquote>

<h3>
Understanding the SPECINFO CHANNEL Function
</h3>

<blockquote>
<p>
This function displays the number of the analysis channel in which the 
specified frequency is most likely to occur.  Note however that in 
practice a frequency may be displaced by up to 8 channels on either 
side of the anticipated channel.
</p>

<p>
Note that this does not mean that the frequency you give is actually 
present in that channel, only that this is the channel it <i>would</i> 
be in if it were present.  To determine which frequencies in a soundfile 
for which you might want channel information, you could use 
<a href="crepitch#GETPITCH"><b>REPITCH GETPITCH</b></a>, extracting the pitch 
data as a breakpoint file so that it can be examined easily.  However, do 
note that there will be a weighting towards harmonic partials, though not 
exclusively, because GETPITCH is focused on 'pitch' as such;  'pitches' 
usually sound as they do because of the focusing effect of harmonically 
related partials (i.e., integer multiples of the fundamental).
</p>
</blockquote>

<h3>
Musical Applications
</h3>

<blockquote>
<p>
This function may have become largely redundant since CDP Release 4.  
It was needed earlier to specify a 'frequency divide channel number', but 
this is now handled internally by the relevant functions.  Still, it may 
be instructive to look at which channels various frequencies occur in, 
for example when deciding on the number of analysis bands to have 
(frequency resolution).
</p>
</blockquote>

<p>
End of SPECINFO CHANNEL<br>
<a href="#SPECINFOLIST"><b>Return</b></a> to List of functions to obtain 
information on analysis data at top of this file<br>
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> 
to Main Index for the CDP System.<br>
<a href="cspecndx.htm" Target="_top">Return</a> 
to Spectral Index
</p>

<hr><!-- ********************************************************* -->
 
<h2 id="FREQUENCY">SPECINFO FREQUENCY &#150; Returns the centre 
frequency of the PVOC channel specified</h2>

<h3>
Usage
</h3>
<b>specinfo frequency</b> <i>infile analysis_channel_number</i>
<br>

<h3>
Parameters
</h3>

<blockquote>
<i>infile</i> &#150; input analysis file made with PVOC<br>
<i>analysis_channel_number</i> &#150; number of the analysis channel for which 
you would like to know the corresponding frequency. (Range: from 1 to 
the number of channels in the analysis, as given for the <b>-N</b> flag 
of PVOC.)
</blockquote>

<h3>
Understanding the SPECINFO FREQUENCY Function
</h3>

<blockquote>
<p>
The same caution applies as was stated for SPECINFO CHANNEL:  the 
frequency returned may or may not actually be present in that channel.  
This function simply identifies the frequencies that correspond to 
a given analysis channel.  It's a mathematical correlation, not an 
actual analysis of a real sound.
</p>
</blockquote>

<h3>
Musical Applications
</h3>

<blockquote> 
<p>
As with SPECINFO CHANNEL, largely redundant since CDP Release 4, but possibly useful for 
noting frequency and channel correlations. 
</p>
</blockquote>

<p>
End of SPECINFO FREQUENCY<br>
<a href="#SPECINFOLIST"><b>Return</b></a> to List of functions to obtain 
information on analysis data at top of this file<br>
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> 
to Main Index for the CDP System.<br>
<a href="cspecndx.htm" Target="_top">Return</a> 
to Spectral Index
</p>

<hr><!-- ********************************************************* -->

<h2 id="GETPARTIALS">GET_PARTIALS HARMONIC &#150; Extract relative 
amplitudes of partials in a pitched source</h2>

<h3>
Usage
</h3>
<b>get_partials harmonic 1-2</b> <i>inanalfile outfile fundamental 
threshold</i> [<b>-v</b>]<br />
<b>get_partials harmonic 3-4</b> <i>inanalfile outfile fundamental 
threshold time</i> [<b>-v</b>]
<br />

<p>
Example command line to get harmonic partials :<br>
	<blockquote>
	<b><code>get_partials harmonic 1 four1grabbed.ana fourpartials.txt 
	100 0.054</code></b>
	</blockquote>
</p>

<h3>
Modes
</h3>

<blockquote>
<b>1</b>&nbsp; Convert single analysis window to FRQ and amplitude 
list<br />
<b>2</b>&nbsp; Convert single analysis window to MIDI and amplitude 
list<br />
<b>3</b>&nbsp; Convert window at time <i>time</i> to FRQ and amplitude 
list<br />
<b>4</b>&nbsp; Convert window at time <i>time</i> to MIDI and amplitude 
list
</blockquote>

<h3>
Parameters
</h3>

<blockquote>
<i>inanalfile</i> &#150; input analysis file;  for Modes <b>1-2</b> it 
must have only a single analysis window (see <a href = "cspec.htm#GRAB">
SPEC GRAB</a>)<br />
<i>outfile</i> &#150; output text file (see <b>-v</b> flag below)<br />
<i>fundamental</i> &#150; fundamental frequency for the harmonics<br />
<i>threshold</i> &#150; (relative) level below which partials are 
ignored &#150; lower values capture more partials (Range: 0.000002 
to 1.0)<br />
<i>time</i> &#150; (multiple window files only):  time of window to 
use<br />
<b>-v</b> &#150; gives output in format for <a href = 
"cgrofilt.htm#VARIBANK">FILTER VARIBANK</a> file

</blockquote>

<h3>
Understanding the GET_PARTIALS HARMONIC Function
</h3>

<blockquote>
The output for the above example command line as contained in 
<i>fourpartials.txt</i> (Mode <b>1</b>) is:
<pre>
<font color = "FF0000">harm_partial	amplitude</font>
200.000000	0.690151
400.000000	1.000000
500.000000	0.789301
700.000000	0.130861
900.000000	0.356995
1100.000000	0.166859
</pre>
The input was <i>four.ana</i>, the word 'four' extracted from 
<i>count.wav</i>.  It is 1.026 sec long, and a single window was 
'grabbed' at time 0.5, forming the input file for GET_PARTIALS.
</p>

<p>
When the <b>-v</b> flag is invoked, the output is a text file in 
the format required as an input for FILTER VARIBANK, and looks like 
this:
<pre>
0       100.000000  1.0
100000  100.000000  1.0
#
0     2 0.690151  4 1.000000  5 0.789301  7 0.1310861  9 0.356995  11 0.166859
10000 2 0.690151  4 1.000000  5 0.789301  7 0.1310861  9 0.356995  11 0.166859
</pre>
See <a href = "filestxt.htm#FILTERVFILES"><i>CDP File Formants &amp; 
Codes</i></a> for more information about this format.
</p>

<p>
In Mode <b>2</b>, the partials are displayed in MIDI Pitch Values (MPV), 
the above output becomes:
<pre>
<font color = "FF0000">harm_partial	amplitude</font>
55.349957	0.690151
67.349953	1.000000
71.213089	0.789301
77.038216	0.130861
81.389053	0.356995
84.863136	0.166859
</pre>
</p>

<p>
In Modes <b>3</b> &amp; <b>4</b>, the input does not have to be a 
single analysis window.  Thus we can use the original analysis file 
from which we grabbed a window for Mode <b>1</b>, <i>four.ana</i>.  
If we give GET_PARTIALS the same time as we used for the grab (at 
0.54 sec), we should get the same result:<br />
<b><code>get_partials harmonic 3 four.ana fourpartials.txt 100 0.05 
0.54</code></b><br />
The same partials are grabbed, but the amplitudes are very marginally 
different, e.g., 0.687556 instead of 0.690151.  Again, the <b>-v</b> 
option is available.
</p>

<p>
Mode <b>4</b> does the same with the partials expressed in MIDI values.
</p>
</blockquote>

<h3>
Musical Applications
</h3>

<blockquote>
<p>
The importance of this function is that it is looking for <i>harmonic</i> 
partials, i.e., those related by an integer multiple.  This is easily 
seen with the display in frequency values (200, 400, 500 etc.), but 
not so easily seen with the MIDI values, though they are accurate.  
(See our <a href = "notechrt.htm"><i><b>Equivalent Pitch Notations</b></i></a> 
Chart.)
</p>

<p>
If you wanted the harmonics of a specific fundamental, e.g., MIDI 48 
(Low C), you can look it up on the above-mentioned Chart (it's 130.81) 
or use <a href = "cgroinfo.htm#UNITS"><b>SNDINFO UNITS</b></a> to convert 
from MIDI to frequency.  E.g., MIDI 50.2 = 148.538494.  The output 
from GET_PARTIALS then enables you to work with the harmonics specifically 
related to that fundamental.  Without the <b>-v</b> flag, the output 
text file can be used with <a href = "cgrofilt.htm#USERBANK"><b>FILTER 
USERBANK</b></a>, and when the <b>-v</b> flag is invoked, the output 
text file can be used with <a href = "cgrofilt.htm#VARIBANK"><b>FILTER 
VARIBANK</b></a>, which can handle a time-varying filterbank.
</p>
</blockquote>
<p>
<b>ALSO SEE:</b> <a href = "glosstec.htm#HARMONIC"><b>HARMONIC</b></a> in the 
Technical Glossary.
</p>

<p>
End of GET_PARTIALS HARMONIC<br />
<a href="#SPECINFOLIST"><b>Return</b></a> to List of functions to obtain 
information on analysis data at top of this file<br />
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> to Main Index for 
the CDP System.<br />
<a href="cspecndx.htm" Target="_top"><b>Return</b></a> 
to Spectral Index
</p>

<hr> <!-- **************************************************** -->

<h2 id="LEVEL">SPECINFO LEVEL &#150; Convert (varying) level of the 
analysis file to a pseudo-soundfile (1 window -&gt; 1 sample)</h2>

<h3>
Usage
</h3>
<b>specinfo level</b> <i>infile outsndfile</i>
<br>

<h3>
Parameters
</h3>

<blockquote>
<i>infile</i> &#150; input analysis file made with PVOC<br>
<i>outsndfile</i>&#150; a 'pseudo-soundfile' which can be viewed with a 
soundfile display program;  it displays the amplitude shape of the 
sequence of windows.  <b>Warning:</b> Do not attempt to play this file!
</blockquote>

<h3>
Understanding the SPECINFO LEVEL Function
</h3>
<blockquote>

<p>
LEVEL constructs a pseudo-soundfile in which the amplitude level of each 
analysis window becomes the amplitude level of each 'sample' in the 
display.  This pseudo-soundfile can then be viewed with most sound 
waveform display programs.  Each window is in fact a frame time: 
1&#47;analysis_rate.  See the <i>Phase Vocoder</i> Reference Manual for 
a discussion of frames.
</p>
</blockquote>

<h3>
Musical Applications
</h3>

<blockquote>
<p>
The purpose of this program is to enable the user to get an overall 
picture of where in the analysis file the strongest signal lies.
</p>

<p>
The CDP <b>VIEWSF</b> program, available on the PC, 
will display the level of each analysis window on the 0 to 
32767 scale.  Use the zoom function to get a sample level display.  
The time shown is reckoned by the VIEWSF program to relate to samples, 
not to analysis windows, so it does not actually display the real 
time in the analysis file.
</p>

<p>
Each vertical line in the SPECINFO LEVEL pseudo-soundfile actually 
relates to <i>sample_rate&#47;analysis_rate</i> samples.  For example, 
22050 (the sample rate) divided by 172 (the analysis rate) = 128.  
(Note that in the <a href="csysutil.htm#DIRSF"><b>DIRSF</b></a> display, the analysis rate is shown in the 
number-of-channels column.)  <b>VIEWSF</b> thinks that this is only one 
sample (of sound) and will show the time accordingly.  Therefore, to 
convert to the real time in the soundfile, you need to multiply the 
time displayed by the number of samples it really represents:<br>
&nbsp;&nbsp;&nbsp;&nbsp;<b><code>real_time = time_displayed * (sample_rate&#47;analysis_rate)</code></b>.
</p>

<p>
This information indicates where in the sound the frequencies have 
the greatest amplitude, which may be useful when determining how and 
when to apply filtering to the sound.
</p>
</blockquote>

<p>
End of SPECINFO LEVEL<br>
<a href="#SPECINFOLIST"><b>Return</b></a> to List of functions to obtain 
information on analysis data at top of this file<br>
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> 
to Main Index for the CDP System.<br>
<a href="cspecndx.htm" Target="_top"><b>Return</b></a> 
to Spectral Index
</p>

<hr><!-- ********************************************************* -->

<h2 id = "PEAKEXTRACT">PEAK EXTRACT &#150; Extract spectral peaks from analysis file and write to a text file
</h2>

<h3>
Usage
</h3>
<b>peak extract 1</b> <i>inanalfile outtextfile winsiz peak floor lo hi</i> 
[<b>-h</b>tune] [<b>-a</b>] [<b>-m</b>] [<b>-q</b>] [<b>-z</b>]<br />
<b>peak extract 2</b> <i>inanalfile outtextfile winsiz peak floor lo hi</i> 
[<b>-h</b>tune] [<b>-a</b>] [<b>-m</b>] [<b>-q</b>] [<b>-z</b>] 
[<b>-f</b>]<br />
<b>peak extract 3</b> <i>inanalfile outtextfile winsiz peak floor lo hi</i> 
[<b>-h</b>tune] [<b>-a</b>] [<b>-m</b>] [<b>-q</b>] [<b>-z</b>] 
[<b>-f</b>]<br />
<b>peak extract 4</b> <i>inanalfile outtextfile winsiz peak floor lo hi</i> 
[<b>-h</b>tune] [<b>-a</b>] [<b>-m</b>] [<b>-q</b>] [<b>-z</b>] 
[<b>-f</b>]<br />
<br />

<p>
Example command lines:<br>
	<blockquote>
	<b><code>peak extract 1 four fourtxtm1.txt 2 2 0.001 86 1000</code>
	</b><br />
	<b><code>peak extract 1 four fourtxtm1.txt 2 2 0.001 86 1000 -m -q</code>
	</b><br />
	<b><code>peak extract 2 four fourtxtm1.txt 2 2 0.001 86 1000 -a -q 
	-f</code></b>
	</blockquote>
</p>

<h3>
Modes
</h3>

<blockquote>
<b>1</b>&nbsp; List the spectral peaks as they vary in time.<br>
<b>2</b>&nbsp; Stream the spectral peaks, using the maximum number of peaks found.<br>
<b>3</b>&nbsp; Stream the spectral peaks, using the most prominent pitches found.<br>
<b>4</b>&nbsp; List the most prominent peaks found as fixed average values.
</blockquote>

<h3>
Parameters
</h3>

<blockquote>
<p>
<i>inanalfile</i> &#150; input analysis file<br />
<i>outtextfile</i> &#150; output text file containing the specified 
peak information<br />
<i>winsiz</i> &#150; the process divides each analysis window into a number of (overlapping) subwindows, and <i>winsize</i> determines the width of this subwindow, in semitones.  Smaller values reduce the number of peaks 
found.  Range: 1 - 96. (Recommended 12)<br />
<i>peak</i> &#150; in each subwindow, the process finds the median 
amplitude of the channels.  It then looks for those channels whose 
amplitude is <i>peak</i> times louder than the median and initially 
assumes these are spectral peaks.  Range: 1 - 1000. (Recommended 1.5+)<br />
<i>floor</i> &#150; the peak amplitudes must also exceed a minimum 
<i>floor</i> amplitude before they are accepted as true peaks &#150; 
<i>floor</i> sets this level.  Range: 0.0001 - 1. (Recommended ca .001)<br />
<i>lo</i> &#150; determines the lowest frequency acceptable for a 
retained peak.  Range: <i>analysis channel width</i> to <i>nyquist</i>.<br />
<i>hi</i> &#150; determines the highest frequency acceptable for a retained peak.  Range: <i>analysis channel width</i> to <i>nyquist</i>.<br />
<b>-h</b><i>tune</i> &#150; If tune is <b>non-zero</b>, the process 
searches the peaks to discover if any of them are harmonics of other peaks.  
If they are, <b>the harmonic-peaks are excluded</b>.  Peaks are judged to be 
harmonics if they are in tune with the expected frequency of a harmonic.  
The accuracy of tuning required (in semitones) is set by the value of 
<i>tune</i>.  If tune is set to <b>zero</b>, <b>all</b> peaks are retained.  
Range: 0 - 6. (Recommended 1).<br />
<b>Important ways to specify how the peak data should be displayed</b> 
(many examples of various settings and combinations of settings are 
given below):<br />
<b>-a</b> &nbsp;&#150; suppress amplitude information in the output<br />
<b>-m</b> &#150; express frequency data as (posibly fractional) MIDI 
values<br />
<b>-q</b> &nbsp;&#150; quantise frequency or midi output to the nearest 
quarter-tones of the tempered scale<br />
<b>-z</b> &nbsp;&#150; show peakfree segments in the data, by printing zeros 
in the output<br />
<b>-f</b>&nbsp;&nbsp;&#150; format the output as a data file for the <a href = 
"cgrofilt.htm#VARIBANK">FILTER VARIBANK</a> process.  Also see 
<a href = "filestxt.htm#FILTERVFILES"><b><i>Files &amp; Codes</i></b></a> 
for more information on this file format.
	<ul>
	<li>The <b>nyquist</b> frequency is half the sampling rate of 	the original soundfile from which the analysis file was derived.</li>
	
	<li>The <b>analysis channel width</b> is the nyquist divided 	by 	half of the analysis-channels parameter used to create the analysis file.  
	The analysis-channels parameter is the <a href = 
	"glosstech.htm#ANALSETTINGS"><b>FFTsize</b></a>, such as 1024, the 
	default value.  Thus the <b>analysis channel width</b> is 
	(SR&#47;2) &#47; (AnalChannels&#47;2):  (44100&#47;2) &#47; 
	1024&#47;2) + 22050 &#47; 512 = 43.066 (Hz).  This would be the 
	normal minimum value for <i>lo</i>, but it would be larger if 
	there were fewer analysis channels (e.g., 512), and smaller if 
	there were more. e.g., 2048 or 4096), and would also change if 
	the sample rate were different.</li>
	</ul>

<div align = center>
<table border = 1 cellpadding = 4 bgcolor = "#B0E0E6">
<caption><font size = +1><b>Table of Optional Flag Combinations</b>
</font></caption>
<tr>
<th align = center>Flags</th>
<th align = center>Results</th>
</tr>

<tr>
<td align = left><b>-m</b> &amp; <b>-q</b> </td>
<td align = left>Frq in MIDI vals quantised to nearest &#188;-tone</td>
</tr>

<tr>
<td align = left><b>-a</b> &amp; <b>-f</b> </td>
<td align = left>FILTER VARIBANK format, amplitudes set to 1.0 (so the 
field is not missing)</td>
</tr>
<tr>
<td align = left><b>-q</b> &amp; <b>-f</b> </td>
<td align = left>FILTER VARIBANK format, frq in Hz quantised to the 
nearest &#188;-tone</td>
</tr>
<tr>
<td align = left><b>-a</b> &amp; <b>-m</b>  &amp; <b>-f</b> </td>
<td align = left>FILTER VARIBANK format, amplitudes set to 1.0, 
and frqs in MIDI vals</td>
</tr>
<tr>
<td align = left><b>-a</b> &amp; <b>-q</b>  &amp; <b>-f</b> </td>
<td align = left>FILTER VARIBANK format, amplitudes set to 1.0, 
and frqs in Hz</td>
</tr>
<tr>
<td align = left><b>-m</b> &amp; <b>-q</b>  &amp; <b>-f</b> </td>
<td align = left>FILTER VARIBANK format, frqs in MIDI vals quantised 
to the nearest &#188;-tone, and all amplitudes are 0.0</td>
</tr>
<tr>
<td align = left><b>-a</b> &amp; <b>-m</b>  &amp; <b>-q</b> 
 &amp; <b>-f</b></td>
<td align = left>FILTER VARIBANK format, frq in MIDI vals quantised to 
the nearest &#188;-tone,<br /> and amplitudes set to 1.0</td>
</tr>
</table>
</div>

</p>
</blockquote>

<h3>
Understanding the PEAK EXTRACT function
</h3>

<blockquote>
PEAK EXTRACT searches for the peaks in the spectrum in an analysis file.  
Unlike <a href = "crepitch.htm#GETPITCH">REPITCH GETPITCH</a>, it is not 
searching for a specific pitch in each window, but merely whatever peaks 
it can find.  It is therefore more appropriate for finding the pitch 
content of multipitched sources.
</p>

<p>
The process is based on a method using median amplitudes, suggested by 
Bill Sethares (verbal communication at CCMIX in Paris) together with a 
best fit algorithm and semitone-bin assignment devised by T Wishart.
</p>

<p>
<b>The various modes of the process are used as follows.</b>
</p>

<p>
<b>Mode 1 &#150; Finding and Listing Peaks</b>
<blockquote>
The window-time and the peaks in the window are listed, one window 
at a time.  Output might look like this, where the columns represent 
<font color = "#FF0000">time frq 1 amp1 [frq2 amp2 ....]</font>:<br />
<br />
<code>
0.072562	356.607666 0.000719<br>
0.075465	354.271942 0.000862<br>
0.078367	354.491180 0.001014<br>
0.081270	353.553528 0.001173		435.571716 0.000764<br>
0.087075	354.383575 0.001534<br>
0.089977	356.247406 0.001930<br>
0.092880	355.165039 0.001831<br>
0.095782	349.447784 0.003151<br>
0.101587	348.444855 0.004650		436.394318 0.002715<br>
0.104490	349.419006 0.005525		379.522858 0.002046<br>
0.107392	350.585388 0.006362<br>
</code>
<br />
Note that different windows may have different numbers of peaks.
</p>

<p>
With the <b>-a</b> flag set, the amplitude information is suppressed, 
and output would look like this:<br />
<font color = "#FF0000">time frq1 [frq2 ...]</font><br />
<br />
<code>
0.072562	 356.607666<br>
0.075465	 354.271942<br>
0.078367	 354.491180<br>
0.081270	 353.553528	 435.571716<br>
0.087075	 354.383575<br>
0.089977	 356.247406<br>
0.092880	 355.165039<br>
0.095782	 349.447784<br>
0.101587	 348.444855	 436.394318<br>
0.104490	 349.419006	 379.522858<br>
0.107392	 350.585388<br>
</code>
</p>

<p>
With the <b>-z</b> flag set, any window with no peaks at all ('peakfree') 
will be shown in the output by zero-entries.  Output would look like 
this:<br />
<br />
<code>
0.000000	0 0<br>
0.072562	356.607666 0.000719<br>
0.075465	354.271942 0.000862<br>
0.078367	354.491180 0.001014<br>
0.081270	353.553528 0.001173	 435.571716 0.000764<br>
0.084172	0 0<br>
0.087075	354.383575 0.001534<br>
0.089977	356.247406 0.001930<br>
0.092880	355.165039 0.001831<br>
0.095782	349.447784 0.003151<br>
0.098685	0 0<br>
0.101587	348.444855 0.004650	 436.394318 0.002715<br>
0.104490	349.419006 0.005525	 379.522858 0.002046<br>
0.107392	350.585388 0.006362<br>
</code>
</p>

<p>
With the <b>-m</b> flag set, the frequency values are converted to 
MIDI values.  Output would look like this:<br />
<br />
<code>
0.072562	 65.362007 0.000719<br>
0.075465	 65.248245 0.000862<br>
0.078367	 65.258949 0.001014<br>
0.081270	 65.213097 0.001173	 68.824883 0.000764<br>
0.087075	 65.253700 0.001534<br>
0.089977	 65.344513 0.001930<br>
0.092880	 65.291832 0.001831<br>
0.095782	 65.010880 0.003151<br>
0.101587	 64.961121 0.004650	 68.857544 0.002715<br>
0.104490	 65.009453 0.005525	 66.440201 0.002046<br>
0.107392	 65.067146 0.006362<br>
</code>
</p>

<p>
With the <b>-m</b> and <b>-q</b> flags set, the frequency values are 
converted to MIDI <i>and</i> quantised to the nearest quartertone.  
The output would look like this:<br />
<br />
<code>
0.072562	 65.5 0.000719<br>
0.075465	 65.0 0.000862<br>
0.078367	 65.5 0.001014<br>
0.081270	 65.0 0.001173	 69.0 0.000764<br>
0.087075	 65.5 0.001534<br>
0.089977	 65.5 0.001930<br>
0.092880	 65.5 0.001831<br>
0.095782	 65.0 0.003151<br>
0.101587	 65.0 0.004650	 69.0 0.002715<br>
0.104490	 65.0 0.005525	 66.5 0.002046<br>
0.107392	 65.0 0.006362<br>
</code>
</p>

<p>
With only the <b>-q</b> flag set, the frequency values are converted 
to the nearest quartertone, but output as frequency values.  The output 
would look like this:<br />
<br />
<code>
0.072562	 359.461395 0.000719<br>
0.075465	 349.228241 0.000862<br>
0.078367	 359.461395 0.001014<br>
0.081270	 349.228241 0.001173	 440.000000 0.000764<br>
0.087075	 359.461395 0.001534<br>
0.089977	 359.461395 0.001930<br>
0.092880	 359.461395 0.001831<br>
0.095782	 349.228241 0.003151<br>
0.101587	 349.228241 0.004650	 440.000000 0.002715<br>
0.104490	 349.228241 0.005525	 380.836090 0.002046<br>
0.107392	 349.228241 0.006362<br>
</code>
<br />
(Compare this with the first table of output.)
</p>
</blockquote>

<h3>
Modes 2 to 4:  Streaming the data
</h3>

<p>
	<ul>
	<li><b>NB:</b> In some of the streamed data displays, below, the 
	lines may be so long that they "wrap-around" because they will 
	not fit on the displayed page on your computer.  However, the 
	data itself does not wrap around, and each row contains the 
	same number of columns, despite appearances to the contrary.</li>

	<li>The aim of streaming the data is to track the peaks as they 
	pass from one window to the next.</li>

	<li>A stream will corresponds to a pair of columns of data 
	(frequency + amplitude) in the output.</li>

	<li>In general not all the window will have the same number of 
	peaks.</li>

	<li>PEAK EXTRACT has two methods to assign peaks to streams:  
	Mode <b>2</b> uses the <b>maximum number of peaks</b> found, and 
	Mode <b>3</b> uses the <b>most prominent pitches</b> found.</li>
	</ul>
</p>

<p>
<b>Mode 2: Stream the spectral peaks, using the maximum number of peaks 
found</b>
<blockquote>
<p>
This process first looks for the windows with the maximum number of peaks. 
It uses this as the number of streams it will output.
</p>

<p>
However, some window may have less than the maximum number of peaks.  For 
these windows, the process predicts where the centre frequency of the 
streams might be and then assigns the actual peaks to the available 
streams to get the best fit of the data: i.e., the deviation of the 
<i>actual peak frequency</i> from the <i>predicted stream frequency</i> 
is at a minimum.
</p>

<p>
The remaining streams (which have no corresponding peaks) are given a 
<b>zero amplitude</b> at this time and assigned to the <i>predicted 
frequency</i> of the stream.
</p>

<p>
The output might look like this <font color = "#FF0000">time frq1 amp1 
[frq2 amp2 ...]</font>:<br />
<br />
<code>
0.197370	 122.435066 0.000000	 353.447144 0.076715	 433.644592 0.000000	 525.059875 0.025843	 572.628113 0.000000<br>
0.200272	 130.600586 0.001569	 355.624725 0.071684	 433.644592 0.000000	 533.026001 0.000000	 572.628113 0.000000<br>
0.203175	 122.435066 0.000000	 354.864227 0.068599	 433.644592 0.000000	 526.530640 0.017870	 572.628113 0.000000<br>
0.206077	 122.435066 0.000000	 249.924759 0.047720	 353.834137 0.067311	 533.026001 0.000000	 572.628113 0.000000<br>
0.208980	 122.435066 0.000000	 246.898758 0.052282	 350.662476 0.067316	 533.026001 0.000000	 572.628113 0.000000<br>
0.211882	 122.435066 0.000000	 348.227264 0.063584	 406.975525 0.024158	 525.834778 0.034635	 572.628113 0.000000<br>
0.214785	 122.435066 0.000000	 249.414642 0.069781	 346.354675 0.055594	 533.026001 0.000000	 572.628113 0.000000<br>
0.217687	 122.435066 0.000000	 251.439682 0.077112	 433.644592 0.000000	 533.026001 0.000000	 703.172241 0.000754<br>
0.220590	 122.435066 0.000000	 251.685486 0.078068	 433.644592 0.000000	 533.026001 0.000000	 572.628113 0.000000<br>
0.223492	 122.435066 0.000000	 248.102814 0.075569	 433.644592 0.000000	 527.619629 0.037400	 572.628113 0.000000<br>
</code>
<br />
Note that there are the same number of entries in each row, and the data corresponds to 5 streams.  Also note that most entries in streams 1 and 5 
have zero amplitude.  At those times, these streams have no corresponding 
peak.
</p>
</blockquote>

<p>
<b>Mode 3: Stream the spectral peaks, using the most prominent pitches 
found</b>
<blockquote>
<p>
This process assumes that the spectrum is relatively stable.  It scans 
the entire file, and counts the peaks occurring within every semitone 
interval.  It then looks for the most prominent (the most frequently 
visited) semitones, the peaks in the '<i>semitone-spectrum</i>'.  The 
number of these peaks is used as the number of streams, and the 
peak-frequencies determine the predicted centres of the streams.
The peaks in each window are then assigned to these streams.
</p>

<p>
In this process, some window may have less peaks than the number of 
streams.  The peaks are assigned to the streams using the best-fit 
approach described above.  Also, some window may have more peaks than 
the number of streams.  Again, a best fit procedure determines which 
peaks to retain and which to discard.
</p>

<p>
The output might look like this <font color = "#FF0000">time frq1 amp1 
[frq2 amp2 ....]</font>:<br />
<br />
<code>
0.197370	 187.935364 0.000000	 223.494080 0.000000	 250.863602 0.000000	 353.447144 0.076715	 446.988159 0.000000	 525.059875 0.025843	 632.136719 0.000000<br>
0.200272	 187.935364 0.000000	 223.494080 0.000000	 250.863602 0.000000	 355.624725 0.071684	 446.988159 0.000000	 528.049866 0.027765	 632.136719 0.000000<br>
0.203175	 187.935364 0.000000	 223.494080 0.000000	 250.863602 0.000000	 354.864227 0.068599	 446.988159 0.000000	 526.530640 0.017870	 632.136719 0.000000<br>
0.206077	 187.935364 0.000000	 223.494080 0.000000	 250.863602 0.000000	 353.834137 0.067311	 446.988159 0.000000	 531.561462 0.000000	 632.136719 0.000000<br>
0.208980	 187.935364 0.000000	 223.494080 0.000000	 250.863602 0.000000	 350.662476 0.067316	 446.988159 0.000000	 531.561462 0.000000	 632.136719 0.000000<br>
0.211882	 187.935364 0.000000	 223.494080 0.000000	 250.863602 0.000000	 348.227264 0.063584	 406.975525 0.024158	 525.834778 0.034635	 632.136719 0.000000<br>
0.214785	 187.935364 0.000000	 223.494080 0.000000	 250.863602 0.000000	 346.354675 0.055594	 446.988159 0.000000	 531.561462 0.000000	 632.136719 0.000000<br>
0.217687	 187.935364 0.000000	 223.494080 0.000000	 251.439682 0.077112	 354.774719 0.000000	 446.988159 0.000000	 531.561462 0.000000	 632.136719 0.000000<br>
0.220590	 187.935364 0.000000	 223.494080 0.000000	 251.685486 0.078068	 354.774719 0.000000	 446.988159 0.000000	 531.561462 0.000000	 632.136719 0.000000<br>
0.223492	 187.935364 0.000000	 223.494080 0.000000	 248.102814 0.075569	 354.774719 0.000000	 446.988159 0.000000	 527.619629 0.037400	 632.136719 0.000000<br>
</code>
<br />
Note that in both these cases, the output data is in the format of a 
<a href = "cgrofilt.htm#VARIBANK">FILTER VARIBANK</a> data file.  However, 
in general the amplitudes obtained from the channel peaks are very low.  
If the <b>-f</b> flag is set, these amplitudes are normalised in the 
output.
</p>
</blockquote>
</p>

<p>
<b>Format of the output with Modes 1-3</b>
	<blockquote>
	If the <b>-f</b> and <b>-a</b> flags are set, the amplitude data is 
	discarded.  However, the <a href = "cgrofilt.htm#VARIBANK">FILTER 
	VARIBANK</a> data format requires an amplitude be assigned to each 
	pitch entry.  So the amplitudes in the output <b>default to 1.0.</b>
	</blockquote>
</p>

<p>
<b>Returning to Mode 2 (stream the spectral peaks, using the maximum 
number of peaks found)</b>
</p>

<blockquote>
<p>
The original output might look this <font color = "#FF0000">time frq1 amp1 [frq2 amp2 ...]</font>:<br />
<br />
<code>
0.197370	 122.435066 0.000000	 353.447144 0.076715	 433.644592 0.000000	 525.059875 0.025843	 572.628113 0.000000<br>
0.200272	 130.600586 0.001569	 355.624725 0.071684	 433.644592 0.000000	 533.026001 0.000000	 572.628113 0.000000<br>
0.203175	 122.435066 0.000000	 354.864227 0.068599	 433.644592 0.000000	 526.530640 0.017870	 572.628113 0.000000<br>
0.206077	 122.435066 0.000000	 249.924759 0.047720	 353.834137 0.067311	 533.026001 0.000000	 572.628113 0.000000<br>
0.208980	 122.435066 0.000000	 246.898758 0.052282	 350.662476 0.067316	 533.026001 0.000000	 572.628113 0.000000<br>
0.211882	 122.435066 0.000000	 348.227264 0.063584	 406.975525 0.024158	 525.834778 0.034635	 572.628113 0.000000<br>
0.214785	 122.435066 0.000000	 249.414642 0.069781	 346.354675 0.055594	 533.026001 0.000000	 572.628113 0.000000<br>
0.217687	 122.435066 0.000000	 251.439682 0.077112	 433.644592 0.000000	 533.026001 0.000000	 703.172241 0.000754<br>
0.220590	 122.435066 0.000000	 251.685486 0.078068	 433.644592 0.000000	 533.026001 0.000000	 572.628113 0.000000<br>
0.223492	 122.435066 0.000000	 248.102814 0.075569	 433.644592 0.000000	 527.619629 0.037400	 572.628113 0.000000<br>
</code>
</p>

<p>
With the <b>-f</b> (FILTER VARIBANK format) and <b>-a</b> (suppress 
amplitude information) flags set, it would look like this (note the 
default amplitudes at 1.0):<br />
<br />
<code>
0.197370	 122.435066 1.0	 353.447144 1.0	 433.644592 1.0	 525.059875 1.0	 572.628113 1.0<br>
0.200272	 130.600586 1.0	 355.624725 1.0	 433.644592 1.0	 533.026001 1.0	 572.628113 1.0<br>
0.203175	 122.435066 1.0	 354.864227 1.0	 433.644592 1.0	 526.530640 1.0	 572.628113 1.0<br>
0.206077	 122.435066 1.0	 249.924759 1.0	 353.834137 1.0	 533.026001 1.0	 572.628113 1.0<br>
0.208980	 122.435066 1.0	 246.898758 1.0	 350.662476 1.0	 533.026001 1.0	 572.628113 1.0<br>
0.211882	 122.435066 1.0	 348.227264 1.0	 406.975525 1.0	 525.834778 1.0	 572.628113 1.0<br>
0.214785	 122.435066 1.0	 249.414642 1.0	 346.354675 1.0	 533.026001 1.0	 572.628113 1.0<br>
0.217687	 122.435066 1.0	 251.439682 1.0	 433.644592 1.0	 533.026001 1.0	 703.172241 1.0<br>
0.220590	 122.435066 1.0	 251.685486 1.0	 433.644592 1.0	 533.026001 1.0	 572.628113 1.0<br>
0.223492	 122.435066 1.0	 248.102814 1.0	 433.644592 1.0	 527.619629 1.0	 572.628113 1.0<br>
</code>
</p>

<p>
We can produce <b>MIDI value output</b> by <i>also</i> setting the 
<b>-m</b> flag, when the output might look like this:<br />
<br />
<code>
0.197370	 46.854156 0.000000	 65.207893 0.076715	 68.748116 0.000000	 72.059738 0.025843	 73.561134 0.000000<br>
0.200272	 47.971893 0.001569	 65.314224 0.071684	 68.748116 0.000000	 72.320427 0.000000	 73.561134 0.000000<br>
0.203175	 46.854156 0.000000	 65.277161 0.068599	 68.748116 0.000000	 72.108162 0.017870	 73.561134 0.000000<br>
0.206077	 46.854156 0.000000	 59.207882 0.047720	 65.226837 0.067311	 72.320427 0.000000	 73.561134 0.000000<br>
0.208980	 46.854156 0.000000	 58.996990 0.052282	 65.070953 0.067316	 72.320427 0.000000	 73.561134 0.000000<br>
0.211882	 46.854156 0.000000	 64.950302 0.063584	 67.649261 0.024158	 72.085274 0.034635	 73.561134 0.000000<br>
0.214785	 46.854156 0.000000	 59.172508 0.069781	 64.856956 0.055594	 72.320427 0.000000	 73.561134 0.000000<br>
0.217687	 46.854156 0.000000	 59.312504 0.077112	 68.748116 0.000000	 72.320427 0.000000	 77.116493 0.000754<br>
0.220590	 46.854156 0.000000	 59.329422 0.078068	 68.748116 0.000000	 72.320427 0.000000	 73.561134 0.000000<br>
0.223492	 46.854156 0.000000	 59.081215 0.075569	 68.748116 0.000000	 72.143936 0.037400	 73.561134 0.000000<br>
</code>
</p>

<p>
And we can <b>quantise</b> this MIDI data to the <i>nearest quartertone</i>, 
by also setting the <b>-q</b> flag (quantise to the nearest quarter-tone), 
when the output might look like this:<br />
<br />
<code>
0.197370	 47.0 1.0	 65.0 1.0	 68.5 1.0	 72.0 1.0	 73.5 1.0<br>
0.200272	 48.0 1.0	 65.5 1.0	 68.5 1.0	 72.5 1.0	 73.5 1.0<br>
0.203175	 47.0 1.0	 65.5 1.0	 68.5 1.0	 72.0 1.0	 73.5 1.0<br>
0.206077	 47.0 1.0	 59.0 1.0	 65.0 1.0	 72.5 1.0	 73.5 1.0<br>
0.208980	 47.0 1.0	 59.0 1.0	 65.0 1.0	 72.5 1.0	 73.5 1.0<br>
0.211882	 47.0 1.0	 65.0 1.0	 67.5 1.0	 72.0 1.0	 73.5 1.0<br>
0.214785	 47.0 1.0	 59.0 1.0	 65.0 1.0	 72.5 1.0	 73.5 1.0<br>
0.217687	 47.0 1.0	 59.5 1.0	 68.5 1.0	 72.5 1.0	 77.0 1.0<br>
0.220590	 47.0 1.0	 59.5 1.0	 68.5 1.0	 72.5 1.0	 73.5 1.0<br>
0.223492	 47.0 1.0	 59.0 1.0	 68.5 1.0	 72.0 1.0	 73.5 1.0<br>
</code>
</p>

<p>
Or we can produce <b>quantised MIDI output</b> but retain the relative amplitudes of each peak by setting the <b>-f</b> (FILTER VARIBANK format), 
the <b>-m</b> (express frequency in MIDI values) and the <b>-q</b> 
(quantise to the nearest quarter-tone) flags.  Now the output might look 
like this:<br />
<br />
<code>
0.197370	 47.0 0.000000	 65.0 0.076715	 68.5 0.000000	 72.0 0.025843	 73.5 0.000000<br>
0.200272	 48.0 0.001569	 65.5 0.071684	 68.5 0.000000	 72.5 0.000000	 73.5 0.000000<br>
0.203175	 47.0 0.000000	 65.5 0.068599	 68.5 0.000000	 72.0 0.017870	 73.5 0.000000<br>
0.206077	 47.0 0.000000	 59.0 0.047720	 65.0 0.067311	 72.5 0.000000	 73.5 0.000000<br>
0.208980	 47.0 0.000000	 59.0 0.052282	 65.0 0.067316	 72.5 0.000000	 73.5 0.000000<br>
0.211882	 47.0 0.000000	 65.0 0.063584	 67.5 0.024158	 72.0 0.034635	 73.5 0.000000<br>
0.214785	 47.0 0.000000	 59.0 0.069781	 65.0 0.055594	 72.5 0.000000	 73.5 0.000000<br>
0.217687	 47.0 0.000000	 59.5 0.077112	 68.5 0.000000	 72.5 0.000000	 77.0 0.000754<br>
0.220590	 47.0 0.000000	 59.5 0.078068	 68.5 0.000000	 72.5 0.000000	 73.5 0.000000<br>
0.223492	 47.0 0.000000	 59.0 0.075569	 68.5 0.000000	 72.0 0.037400	 73.5 0.000000<br>
</code>
</p>

<p>
Again, we can also quantise the data, but keep it in frequency format.  
To do this we need to set the <b>-f</b> (FILTER VARIBANK format) and the 
<b>-q</b> (quantise to the nearest quarter-tone) flags, and the output 
would look like this:<br />
<br />
<code>
0.197370	 123.470825 0.000000	 349.228241 0.076715	 427.474060 0.000000	 523.251160 0.025843	 570.609375 0.000000<br>
0.200272	 130.812790 0.001569	 359.461395 0.071684	 427.474060 0.000000	 538.583557 0.000000	 570.609375 0.000000<br>
0.203175	 123.470825 0.000000	 359.461395 0.068599	 427.474060 0.000000	 523.251160 0.017870	 570.609375 0.000000<br>
0.206077	 123.470825 0.000000	 246.941650 0.047720	 349.228241 0.067311	 538.583557 0.000000	 570.609375 0.000000<br>
0.208980	 123.470825 0.000000	 246.941650 0.052282	 349.228241 0.067316	 538.583557 0.000000	 570.609375 0.000000<br>
0.211882	 123.470825 0.000000	 349.228241 0.063584	 403.481781 0.024158	 523.251160 0.034635	 570.609375 0.000000<br>
0.214785	 123.470825 0.000000	 246.941650 0.069781	 349.228241 0.055594	 538.583557 0.000000	 570.609375 0.000000<br>
0.217687	 123.470825 0.000000	 254.177597 0.077112	 427.474060 0.000000	 538.583557 0.000000	 698.456482 0.000754<br>
0.220590	 123.470825 0.000000	 254.177597 0.078068	 427.474060 0.000000	 538.583557 0.000000	 570.609375 0.000000<br>
</code>
</p>
</blockquote>

<p>
<b>Mode 4: Finding the average peak-frequencies</b>
</p>

<p>
<blockquote>
If the analysis data represents a non-varying spectrum, we may simply 
want to know what the <b>frequencies of the peaks</b> are, <b>on 
average</b>.
</p>

<p>
Mode <b>4</b>: first use the streaming procedure of Mode <b>3</b>, 
then determine the <b>average pitch</b> of each stream.  We also sum 
the amplitude of every window in each stream, then use the stream 
amplitude-sums to determine the <b>relative level</b> of each peak. 
For the same input data, the output would look like this (note that 
there is no <i>time</i> information, just <font color = "#FF0000">
average_frequency &nbsp;relative_level_of_amplitude_sums</font>:<br />
<br />
<code>
93.967637	0.000294<br>
111.727164	0.000460<br>
125.471817	0.000938<br>
149.080771	0.003545<br>
167.896870	0.006329<br>
188.224409	0.207316<br>
250.011853	0.386916<br>
351.188075	1.000000<br>
440.523979	0.117659<br>
530.458239	0.047925<br>
629.244392	0.001581<br>
843.606908	0.000466<br>
1192.913225	0.000074<br>
</code>
<br />
Note that there is no timing information here as the spectrum is 
assumed not to vary in time.
</p>

<p>
With the <b>-q</b> (quantise to the nearest quarter-tone) and <b>-m</b> 
(use MIDI values for frequency) flags set, the output in MIDI values is 
quantised to the nearest quarter-tone, and looks like this:<br />
<br />
<code>
42.5	0.000294<br>
45.5	0.000460<br>
47.5	0.000938<br>
50.5	0.003545<br>
52.5	0.006329<br>
54.5	0.207316<br>
59.0	0.386916<br>
65.0	1.000000<br>
69.0	0.117659<br>
72.0	0.047925<br>
75.0	0.001581<br>
80.5	0.000466<br>
86.5	0.000074<br>
</code>
</p>

<p>
If the <b>-f</b> flag is <i>also</i> used in Mode <b>4</b>, the 
FILTER VARIBANK data format requires time information, so an 
<i>arbitrary</i> data end-time of 1000 seconds is set (16 minutes, 
40.2 seconds).  If a later end-time is required for the output data, 
the output file can be edited.
</p>

<p>
With the <b>-f</b> (FILTER VARIBANK format), the <b>-m</b> (use MIDI 
values for frequency), and the <b>-q</b> (quantise to the nearest 
quarter-tone) flags set, the output is <b>MIDI quantised to nearest quarter-tone</b>.  And with the <b>-a</b> (suppress amplitude information in 
the output) flag <i>also</i> set,  <b>amplitudes all are set to 1.0</b> 
and the output data would look like this <font color = "#FF0000">
time quantised_MIDIfrq1 amp1 [quantised_MIDIfrq2 amp2 ...]</font>:<br />
<br />
<code>
0.0 &nbsp;&nbsp;42.5 1.0 45.5 1.0 47.5 1.0 50.5 1.0 52.5 1.0 54.5 1.0 59.0 1.0 65.0 1.0 69.0 1.0 72.0 1.0 75.0 1.0 80.5 1.0 86.5 1.0<br>
1000 &nbsp;42.5 1.0 45.5 1.0 47.5 1.0 50.5 1.0 52.5 1.0 54.5 1.0 59.0 1.0 65.0 1.0 69.0 1.0 72.0 1.0 75.0 1.0 80.5 1.0 86.5 1.0<br>
</code>
  </blockquote>
</blockquote>

<h3>
Musical Applications
</h3>

<blockquote>
<p>
PEAK EXTRACT searches for the peaks in the spectrum in an analysis file,
regardless of whether the spectrum is pitched or not.  It is appropriate for finding the pitch foci of multi-pitched sources.
</p>

<p>
The output data can be used in processes where pitch or frequency data is required.  In particular, the <a href = "cgrofilt.htm#VARIBANK">FILTER 
VARIBANK</a> output can be used to create filters which tune material to the spectrum found in the analysis file.
</p>
</blockquote>

<p>
<b>ALSO SEE:</b> the entry on the FILTER VARIBANK <a href = 
"filestxt.htm#FILTERVFILES"><b>file format</b></a> in <i>CDP File Formats 
&amp; Codes</i>.
</p>


<p>
End of PEAK EXTRACT<br />
<a href="#SPECINFOLIST"><b>Return</b></a> to list of functions to obtain 
information on analysis data at top of this file<br />
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> to Main Index for 
the CDP System.<br />
<a href="cspecndx.htm" Target="_top"><b>Return</b></a>
to Spectral Index<br />
</p>


<hr> <!-- ********************************************************** -->

<h2 id="OCTVU">SPECINFO OCTVU</a> &#150; Text display of the time-varying 
amplitude of the spectrum, within octave bands</h2>

<h3>
Usage
</h3>
<b>specinfo octvu</b> <i>infile outtextfile time_step</i> 
[<b>-f</b><i>fundamental</i>]
<br>

<h3>
Parameters
</h3>

<blockquote>
<i>infile</i> &#150; input analysis file made with PVOC<br>
<i>outtextfile</i> &#150; output text file<br>
<i>time_step</i> &#150; spread (in milliseconds) of the time points at which 
information is gathered;  band energy is totalled over each 
<i>time_step</i><br>
<b>-f</b><i>fundamental</i> &#150; Octave bands are centred on octave 
transpositions of <i>fundamental</i>, given in Hz.  Default:  centred 
on divisions of the Nyquist frequency (i.e., &#189; the sample rate).<br>
</blockquote>

<h3>
Understanding the SPECINFO OCTVU Function
</h3>

<blockquote>
<p>
The display shows frequency bands horizontally, and the readings at the 
time points for each band vertically, underneath each frequency band 
heading.  The fundamental will influence the frequency starting point for 
the display. Scanning vertically down the time point readings will quickly 
show in which band and at what time the maximum energy is located.  (Using 
a mathematically 'easy' division of the second (e.g., a <i>time_step</i> 
of 250 for &#188; sec, or of 500 for &#189; sec) will make it easier to 
visualise the energy across the time of the sound.)
</p>

<p>
Note that the reported values are <b>relative</b> levels only.  The lowest 
band includes all energy down to '0Hz'.
</p>
</blockquote>

<h3>
Musical Applications
</h3>

<blockquote>
<p>
SPECINFO OCTVU provides an overview of how the spectrum is evolving.  
(Also see SPECINFO PEAK.)  This information can be useful when making 
decisions, for example, about when and at which frequencies to apply 
filtering to a sound.  Also, some functions, such as STRANGE SHIFT, 
have a 'frequency divide' parameter to locate processes above or below 
a certain frequency.  SPECINFO OCTVU can be used to help work out what 
frequency value to give to this parameter.  Note that the <i>time_step</i> 
parameter enables you to set the resolution in time of the information 
gathered &#150; a 'zoom' control.
</p>
</blockquote>

<p>
End of SPECINFO OCTVU<br>
<a href="#SPECINFOLIST"><b>Return</b></a> to list of functions to obtain 
information on analysis data at top of this file<br>
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> 
to Main Index for the CDP System.<br>
<a href="cspecndx.htm" Target="_top">Return</a> 
to Spectral Index
</p>

<hr><!-- ********************************************************* -->

<h2 id="PEAK">SPECINFO PEAK &#150; Locate time-varying energy centre 
of the spectrum</h2>

<h3>
Usage
</h3>
<b>specinfo peak</b> <i>infile outtextfile</i> [<b>-c</b><i>cutoff_frq</i>] 
[<b>-t</b><i>timewindow</i>] [<b>-f</b><i>frqwindow</i>] [<b>-h</b>]
<br>

<h3>
Parameters
</h3>

<blockquote>
<i>infile</i> &#150; input analysis file made with PVOC<br>
<i>outtextfile</i> &#150; output text file of lines of data in this form:<br>
	<blockquote>
	<b><code>WINDOW starttime endtime : PEB lofrq TO hifrq</code></b><br>
	&nbsp&nbsp (where 'PEB' means Peak Energy Band)<br>
	</blockquote>
<b>-c</b><i>cutoff_frq</i>  above which spectral search begins 
(Default = 8.00Hz)<br>
<b>-t</b><i>timewindow</i>  for energy averaging: in SECONDS 
(Default = 0.1000)<br>
<b>-f</b><i>frqwindow</i>  for energy averaging: in OCTAVES 
(Min 0.02.  Default = 0.50)<br>
<b>-h</b>  adjust result for sensitivity of ear<br>
</blockquote>

<h3>
Understanding the SPECINFO PEAK Function
</h3>

<blockquote>
<p>
PEAK searches the spectrum for the time-varying peak energy, i.e., the 
highest amplitude within the given frequency band.  You can define the 
size of the frequency bands you wish to compare (minimum is one channel 
width).  You can also ask the program to average the energy calculations 
over a certain time-window, which you specify.  This avoids tracking every 
micro-fluctuation of energy in the spectrum.
</p>

<p>
The output text file lists the start time of each window (based on the 
window durations specified by you) and indicates the lower and upper 
frequency of the band of maximum energy in each of these windows.
</p>

<p>
The window times shown in the <i>outtextfile</i> are generated 
automatically, starting at time zero and stepping through the file in 
time-chunks specified by you as <i>timewindow</i>.  The <i>timewindow</i> 
parameter therefore operates as a zoom mechanism.  PEB shows you 
the lower and upper frequency of the band of frequencies which has 
the peak energy in that particular window.
</p>
</blockquote>

<h3>
Musical Applications
</h3>

<blockquote>
<p>
The possibility of widening the time window chunks indicates how 
this function can return useful information.  The objective is to 
locate which frequency band contains an energy peak in any given 
time period.  <i>Timewindow</i> gives time resolution and 
<i>frqwindow</i> gives frequency resolution in parts of an octave.
</p><p>
Note that the <i>timewindow</i> is not the same as the analysis 
window.  The duration of an analysis window is the value given for 
<b>-N</b> divided by the sample rate:  e.g., 1024/44100 = an analysis 
window of 0.0232 sec duration.  A <i>timewindow</i> of e.g. 0.1 sec will 
therefore average over about 5 analysis windows and will give 10 data 
entries per second of sound.  This will show where on average in 
those 5 windows, the peak energy occurs.<br>
</p><p>
The information in <i>outtextfile</i> will show which frequency bands 
contain high amplitude data, and where they occur, useful for CUT and 
FILTER operations.
</p><p>
The <i>cutoff_frq</i> parameter enables you to avoid gathering 
unncessary information.
</p>
</blockquote>

<p>
End of SPECINFO PEAK<br>
<a href="#SPECINFOLIST"><b>Return</b></a>to List of functions to obtain 
information on analysis data at top of this file<br>
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> 
to Main Index for the CDP System.<br>
<a href="cspecndx.htm" Target="_top">Return</a> 
to Spectral Index
</p>

<hr><!-- ****************************************************** -->
 
<h2 id="PRINT">SPECINFO PRINT &#150; Print data in an analysis file 
as text to file</h2>

<h3>
Usage
</h3>
<b>specinfo print</b> <i>infile outtextfile time</i> 
<b>-w</b><i>windowcnt</i>
<br>

<h3>
Parameters
</h3>

<blockquote>
<i>infile</i> &#150; input analysis file made with PVOC<br>
<i>outtextfile</i> &#150; name of text file in which to store the data<br>
<i>time</i> &#150; time in <i>infile</i> at which the printout begins<br>
<i>windowcnt</i> &#150; number of windows to print	
	<blockquote>
	<b>Warning:</b> using more than a few windows will generate a huge  textfile.
	</blockquote>
</blockquote>

<h3>
Understanding the SPECINFO PRINT Function
</h3>

<blockquote>
<p>
SPECINFO PRINT provides a way to examine in detail the contents of a 
PVOC analysis file.  It displays amplitude and frequency data for each 
channel, window by window, starting at <i>time</i>.  The sum of all 
values in a single window will give the total amplitude of the sound 
in that window as a value between 0 and 1.  The value in each 
channel therefore indicates the amplitude contribution of that 
channel to the total amplitude of the window.
</p>
</blockquote>

<h3>
Musical Applications
</h3>

<blockquote>
<p>
This function gives a complete listing of the amplitude and frequency 
content of an analysis window.  The more prominent frequencies will 
presumably have higher amplitude values.  Scanning this data should 
indicate where key sonic events occur.
</p>
</blockquote>

<p>
End of SPECINFO PRINT<br>
<a href="#SPECINFOLIST"><b>Return</b></a> to List of functions to obtain 
information on analysis data at top of this file<br>
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> 
to Main Index for the CDP System.<br>
<a href="cspecndx.htm" Target="_top">Return</a> 
to Spectral Index
</p>

<hr><!-- ********************************************************* -->

<h2 id="REPORT">SPECINFO REPORT &#150; Text report on location of 
frequency peaks in the evolving spectrum</h2>

<h3>
Usage
</h3>
<b>specinfo report mode</b> <i>infile outtextfile</i> <b>-f</b><i>N</i> 
&#124; <b>-p</b><i>N</i> [<b>-i</b>] <i>peaks</i> [<b>-b</b><i>bt</i>] 
[<b>-t</b><i>tp</i>] [<b>-s</b><i>val</i>]
<br>

<h3>
Modes
</h3>

<blockquote>
<b>1</b>&nbsp; Report on frequency and time of spectral peaks<br>
<b>2</b>&nbsp; Report spectral peaks in loudness order<br>
<b>3</b>&nbsp; Report spectral peaks as frequency only (no time data)<br>
<b>4</b>&nbsp; Report spectral peaks in loudness order, as frequency only 
(no time data)<br>
</blockquote>

<h3>
Parameters
</h3>

<blockquote>
<i>infile</i> &#150; input analysis file made with PVOC<br>
<i>outtextfile</i> &#150; output text file<br>
<b>-f</b> &#150; extract formant envelope linear frequency-wise, using 
1 point for every <i>N</i> equally-spaced frequency-channels<br>
<b>-p</b>N &#150; extract formant envelope linear pitchwise, using <i>N</i> 
equally-spaced pitch-bands per octave<br>
<b>-i</b> &#150; quicksearch for formants (less accurate)<br>
<i>peaks</i> &#150; (maximum) number of peaks to find.  (Range: 1&#150;16)<br>
<b>-b</b><i>bt</i> &#150; bottom frequency to start peak search<br>
<b>-t</b><i>tp</i> &#150; top frequency to stop peak search<br>
<b>-s</b><i>val</i> &#150; number of windows over which the peaks are averaged.  
(Range 2&#150;4097, Default 9.)  <br>&nbsp; &nbsp; <b>Warning:</b> high values slow up the 
program.
	<p>
	<blockquote>
	Bottom frequency and top frequency may vary over time.<br>
	</p>
	<p>
	See <a href="cformant.htm#extractformants"><b>FORMANTS GET</b></a> 
	for a discussion of the formant extraction options.
	</p>
	</blockquote>
</blockquote>

<h3>
Understanding the SPECINFO REPORT Function
</h3>

<blockquote>
<p>
The report shows the times on the left and the <i>peaks</i> peaks requested 
in columns to the right of each time.  By glancing over the data, one can 
tell at what time and in which frequency bands the peaks occur.  This 
shows the time and frequency location of the spectral energy of the sound.
</p>
</blockquote>

<h3>
Musical Applications
</h3>

<blockquote>
<p>
SPECINFO REPORT gives more detailed information on where the spectral peaks 
are (especially the persistent ones, if you use the <b>-s</b> option).  The 
information about spectral peaks will probably also tell you something 
about where formants are, or where strong audible pitch components are 
located.
</p>
</blockquote>

<p>
End of SPECINFO REPORT<br>
<a href="#SPECINFOLIST"><b>Return</b></a> to List of functions to obtain 
information on analysis data at top of this file<br>
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> 
to Main Index for the CDP System.<br>
<a href="cspecndx.htm" Target="_top">Return</a> 
to Spectral Index
</p>

<hr><!-- ********************************************************* -->

<h2 id="WINDOWCNT">SPECINFO WINDOWCNT &#150; Returns the number of 
analysis windows in <i>infile</i></h2>

<h3>
Usage
</h3>
<b>specinfo windowcnt</b> <i>inanalfile</i>
<br>

<h3>
Parameters
</h3>

<blockquote>
<i>inanalfile</i>  &#150; the only parameter, a PVOC analysis file
</blockquote>

<h3>
Understanding the SPECINFO WINDOWCNT Function
</h3>

<blockquote>
<p>
SPECINFO WINDOWCNT is a simple utility which reports on the number of (time)
windows there are in the analysis file.<br>
</p>
</blockquote>

<h3>
Musical Applications
</h3>
<blockquote>

<p>
Several spectral processes have a <b>WINDOWS</b> parameter. This function ensbles you to check the total number of windows, so that you don't exceed it.<br>
</p>
</blockquote>

<p>
End of SPECINFO WINDOWCNT<br>
<a href="#SPECINFOLIST"><b>Return</b></a> to List of functions to obtain 
information on analysis data at top of this file<br>
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> 
to Main Index for the CDP System.<br>
<a href="cspecndx.htm" Target="_top">Return</a> 
to Spectral Index
</p>

<hr><!--------------------------------------------->

<p>
<h2 align=center id="SPECINFOTECHNICAL">Technical Discussion about FFT Analysis DATA 
</h2>

<p>
An overview of the many aspects of this complex subject can be obtained 
by looking through relevant entries in the <a href="glosstec.htm">
<b>CDP Technical Glossary</b></a>, especially 
<a href="glosstec.htm#ANALYSIS"><b>ANALYSIS</b></a>, 
<a href="glosstec.htm#ANALSETTINGS"><b>ANALYSIS SETTINGS</b></a>, 
<a href="glosstec.htm#FRAME"><b>FRAMES</b></a>, 
<a href="glosstec.htm#PARTIALS"><b>PARTIALS</b></a>, 
<a href="glosstec.htm#SPECTRALDOMAIN"><b>SPECTRAL DOMAIN</b></a>, 
<a href="glosstec.htm#SPECTRALENVELOPE"><b>SPECTRAL ENVELOPE</b></a>, 
<a href="glosstec.htm#SPECTRUM"><b>SPECTRUM</b></a>, 
<a href="glosstec.htm#WINDOW"><b>WINDOW</b></a>, and 
the various entries about <a href="glosstec.htm#FFT"><b>FFT</b></a> itself.
</p>

Regarding the forms of information about spectral data that the SPECINFO 
programs provide, a quick look at the respective differences can be had 
by examining the entries in <b>CDP File Formats &amp; Codes</b> listed 
below:
	<blockquote>
	&bull;&nbsp;
	<a href="filestxt.htm#SPECINFOOCTVUFILES"><b>OCTVU</b>,</a><br>
	&bull;&nbsp;
	<a href="filestxt.htm#SPECINFOPEAKFILES"><b>PEAK</b></a>, and<br>
	&bull;&nbsp;
	<a href="filestxt.htm#SPECINFOREPORTFILES"><b>REPORT</b></a><br>
	</blockquote>
</p>

<p>
End of Technical Discussion<br>
<a href="#SPECINFOLIST"><b>Return</b></a> to List of functions to obtain 
information on analysis data at top of this file<br>
<a href="ccdpndex.htm" Target="_top"><b>Return</b></a> 
to Main Index for the CDP System.<br>
<a href="cspecndx.htm" Target="_top">Return</a> 
to Spectral Index
</p>



<!-- ********************************************************** -->
  <div id = "footer">
   <p>
    <address>
    Last Updated 4 Apr 2023 for CDP8<br />
    Documentation: Archer Endrich<br />
    Revisions: Robert Fraser<br>
    All observations &amp; ideas for improvement appreciated<br />
    Composers Desktop Project Ltd<br />
    Email: cdpse9@gmail.com<br />
    &#169; Copyright 1998-2023 Archer Endrich &amp; CDP<br>
    </address>
   </p>
  </div>

</div> <!-- End of 'right' (contents) indentation -->

</body>

</html>
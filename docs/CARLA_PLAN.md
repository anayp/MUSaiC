# Carla Integration Plan

## Overview
MUSaiC will use [Carla](https://kx.studio/Applications:Carla) as its backend for offline plugin hosting and rendering. Carla provides a headless mode and supports VST2, VST3, AU, LV2, and LADSPA formats.

## Invocation Strategy
We will wrap the Carla CLI binary.
- **Command**: `carla-single` (or `carla-rack` in headless mode).
- **Input**: A `.carla` project file generated by MUSaiC, OR dynamic loading via CLI arguments.
- **Rendering**: Carla can render to audio files in non-realtime (offline) mode if the plugin graph supports it, otherwise we may need to perform faster-than-realtime bounce.

## Track Mapping
- **1 MUSaiC Track** -> **1 Carla Rack** (conceptually).
- We will generate a `.carla` patch file for each track that requires plugin processing.
- The render engine will trigger Carla to process the audio clips defined in the track.

## Automation
- **Strategy**: Map MUSaiC automation curves to MIDI CC messages.
- **Routing**: Send MIDI events to the Carla instance's control port.
- **Alternative**: Generate an automation file that Carla can ingest (OSC).

## Known Limitations
- **VST3**: Support is generally good but requires recent Carla versions.
- **Bridging**: 32-bit/64-bit bridging is handled by Carla.
- **Shell Plugins**: Waves/Kontakt style shells might need specific handling.

## OS Notes
- **Windows**: Set `carlaPath` in `musaic.config.json` or ensure `carla-single`/`Carla.exe` is in PATH.
- **Linux/Mac**: Standard paths.
